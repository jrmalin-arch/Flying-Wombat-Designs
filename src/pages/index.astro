---
import { getCollection } from 'astro:content';
import Layout from '../layouts/layout.astro';

const allProducts = await getCollection('fwdproducts');
---

<Layout title="Flying Wombat Designs">
  <nav class="main-nav">
    <div class="brand-group">
      <a href="/" class="brand-link">
        <img src="/fwd-logo-simple.png" alt="Logo" class="nav-logo" />
        <span class="nav-title">flying wombat designs</span>
      </a>
    </div>

    <div class="nav-controls">
      <a href="/fw-boys-3d-prints" class="tech-shop-button desktop-only">
        <span class="glitch-text">FW BOYS 3D PRINTS</span>
        <span class="button-status">ENTER_SHOP >></span>
      </a>

      <button id="menu-toggle" class="hamburger-toggle" aria-label="Menu">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>

    <div id="mobile-menu" class="dropdown-overlay">
      <a href="/fw-boys-3d-prints">FW Boys 3D Prints Shop</a>
      <a href="/">Flying Wombat Designs</a>
    </div>
  </nav>

  <section class="hero-container">
    <img src="/knit-banner.png" alt="Flying Wombat Designs Banner" class="hero-image" />
    <div class="hero-label-soft">
      <p class="label-text-elegant">Est. 2025 ‚Äî Small Batch Handmade</p>
    </div>
  </section>

  <main class="gallery-container">
    <h1 class="main-headline">
      Handmade <span style="color: var(--accent);">Knits</span> & Jewelry
    </h1>

    <div class="gallery-grid">
      {allProducts.map(item => (
        <a href={`/products/${item.slug}`} class="product-card">
          <div class="card-inner">
            <div class="product-image-box">
               <img 
                src={item.data.gallery?.[0]?.image || '/placeholder.png'} 
                alt={item.data.title} 
               />
            </div>
            <div class="card-content">
              <div class="card-header-row">
                <span class="category-tag">{item.data.category}</span>
                <span class={`status-tag ${item.data.status}`}>
                  {item.data.status === 'in_stock' ? '‚óè In Stock' : 'üõ† Custom'}
                </span>
              </div>
              <h2 class="product-title">{item.data.title}</h2>
              <p class="product-price">{item.data.price}</p>
            </div>
          </div>
        </a>
      ))}
    </div>
  </main>
</Layout>

<style>
  :root { --cyan: #00f2ff; }

  /* PREVENT HORIZONTAL OVERFLOW - Fixes the line issue */
  :global(html, body) {
    overflow-x: hidden;
    width: 100%;
    margin: 0;
    padding: 0;
  }

  #netlify-identity-widget, .netlify-identity-menu, iframe {
    display: none !important;
    pointer-events: none !important;
    visibility: hidden !important;
  }

  /* --- NAVIGATION --- */
  .main-nav {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1rem 5%;
    border-bottom: 4px solid #1A1A1A;
    background: white;
    position: relative;
    min-height: 80px;
    z-index: 1001;
    gap: 15px;
  }
  
  .brand-group { 
    display: flex; 
    align-items: center; 
    flex: 1; 
    min-width: 0; 
  }
  
  .brand-link { 
    display: flex; 
    align-items: center; 
    gap: 12px; 
    text-decoration: none; 
    color: inherit; 
  }
  
  .nav-logo { height: 60px; width: auto; flex-shrink: 0; }
  
  .nav-title { 
    font-family: 'Henny Penny', cursive; 
    font-size: clamp(1.4rem, 5vw, 2.8rem); 
    line-height: 1.1;
    display: block; 
    word-wrap: break-word;
  }

  .nav-controls { 
    display: flex; 
    align-items: center; 
    flex-shrink: 0; 
    min-width: 45px; 
  }

  .tech-shop-button {
    background: #000;
    color: var(--cyan);
    padding: 10px 20px;
    text-decoration: none;
    border: 2px solid var(--cyan);
    font-family: 'Space Mono', monospace;
    display: flex;
    flex-direction: column;
    align-items: center;
    transition: all 0.2s ease;
    box-shadow: 0 0 10px rgba(0, 242, 255, 0.2);
  }
  .glitch-text { font-weight: bold; font-size: 0.9rem; letter-spacing: 1px; }
  .button-status { font-size: 0.6rem; color: #fff; opacity: 0.7; margin-top: 2px; }
  
  .tech-shop-button:hover {
    background: var(--cyan);
    color: #000;
    box-shadow: 0 0 20px rgba(0, 242, 255, 0.5);
  }

  .hamburger-toggle {
    display: none;
    flex-direction: column;
    justify-content: space-around;
    width: 35px;
    height: 25px;
    background: transparent;
    border: none;
    cursor: pointer;
    padding: 0;
  }
  .hamburger-toggle span { width: 100%; height: 4px; background: #1A1A1A; border-radius: 10px; }

  .dropdown-overlay {
    display: none;
    position: absolute;
    top: 100%;
    right: 0;
    width: 100%;
    max-width: 300px;
    background: white;
    border: 4px solid #1A1A1A;
    box-shadow: 10px 10px 0px #1A1A1A;
    flex-direction: column;
    z-index: 1000;
  }
  .dropdown-overlay.open { display: flex; }
  .dropdown-overlay a { padding: 20px; text-decoration: none; color: #1A1A1A; font-family: 'Space Mono', monospace; border-bottom: 1px solid #eee; font-weight: bold; }

  /* --- HERO BREAKOUT: Fixed with 100% calculation --- */
  .hero-container {
    width: 100vw;
    position: relative;
    left: 50%;
    transform: translateX(-50%); /* Better than negative margins for line consistency */
    height: clamp(180px, 40vh, 350px);
    overflow: hidden;
    border-bottom: 4px solid #1A1A1A;
  }
  .hero-image { width: 100%; height: 100%; object-fit: cover; object-position: center; }
  .hero-label-soft {
    position: absolute;
    bottom: 25px;
    left: 5%;
    background: rgba(255, 255, 255, 0.85);
    backdrop-filter: blur(10px);
    padding: 12px 25px;
    border: 1px solid rgba(26, 26, 26, 0.15);
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
  }
  .label-text-elegant { font-family: 'Space Mono', monospace; font-weight: 500; margin: 0; text-transform: uppercase; font-size: 0.85rem; letter-spacing: 2px; color: #1A1A1A; }

  /* --- GALLERY --- */
  .gallery-container { padding: 4rem 5%; }
  .main-headline { font-family: 'Henny Penny', cursive; font-size: clamp(2rem, 6vw, 4.5rem); margin-bottom: 2rem; }
  .gallery-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 40px; }
  .product-card { text-decoration: none; color: inherit; }
  .card-inner { border: 4px solid #1A1A1A; background: white; transition: 0.2s ease; }
  .product-card:hover .card-inner { transform: translate(-8px, -8px); box-shadow: 12px 12px 0px #1A1A1A; }
  
  .product-image-box { 
    width: 100%; 
    aspect-ratio: 4 / 5; 
    overflow: hidden; 
    border-bottom: 4px solid #1A1A1A; 
  }
  .product-image-box img { width: 100%; height: 100%; object-fit: cover; }
  
  .card-content { padding: 1.5rem; }
  .card-header-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem; }
  .category-tag { font-family: 'Space Mono', monospace; color: #666; font-weight: bold; font-size: 0.75rem; text-transform: uppercase; }
  .status-tag { font-family: 'Space Mono', monospace; font-size: 0.7rem; font-weight: bold; text-transform: uppercase; }
  .status-tag.in_stock { color: #2e7d32; }
  .status-tag.custom { color: var(--accent); }

  .product-title { 
    font-family: 'Henny Penny', cursive; 
    margin: 0.5rem 0; 
    font-size: 1.8rem;
    line-height: 1.2;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;  
    overflow: hidden;
    height: 5.5rem; 
  }

  .product-price { font-family: 'Quicksand', sans-serif; font-weight: 700; font-size: 1.4rem; }

  @media (max-width: 1100px) {
    .desktop-only { display: none; }
    .hamburger-toggle { display: flex; }
    .nav-logo { height: 45px; }
    .main-nav { min-height: 70px; gap: 10px; }
    .nav-title { white-space: normal; }
  }
</style>

<script>
  function setupMenu() {
    const toggle = document.getElementById('menu-toggle');
    const menu = document.getElementById('mobile-menu');
    
    if (toggle && menu) {
      toggle.addEventListener('click', (e) => {
        e.stopPropagation();
        menu.classList.toggle('open');
      });

      document.addEventListener('click', (e) => {
        if (menu.classList.contains('open') && !menu.contains(e.target as Node)) {
          menu.classList.remove('open');
        }
      });
    }
  }

  setupMenu();
  document.addEventListener('astro:after-swap', setupMenu);
</script>